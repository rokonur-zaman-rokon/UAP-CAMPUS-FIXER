{% extends 'campus_fixer/base.html' %}
{% load static %}

{% block title %}Lost & Found{% endblock %}

{% block content %}
<style>
    body.lost-found-bg {
        background: url('{% static "campus_fixer/images/uap6.jpg" %}') no-repeat center center fixed;
        background-size: cover;
    }
    .lost-found-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: calc(100vh - 100px);
        padding: 30px;
        background: rgba(0,0,0,0.6);
        border-radius: 12px;
        margin: 80px auto 50px auto;
        max-width: 700px;
        color: #fff;
        text-align: center;
    }
    .lost-found-container input, 
    .lost-found-container select, 
    .lost-found-container textarea {
        width: 100%;
        padding: 10px;
        margin: 8px 0;
        border-radius: 8px;
        border: none;
    }
    .lost-found-container input[type="submit"], 
    .lost-found-container button {
        background: #6366f1;
        color: #fff;
        font-weight: 600;
        cursor: pointer;
        border: none;
        padding: 12px;
        border-radius: 8px;
        transition: 0.3s;
    }
    .lost-found-container input[type="submit"]:hover,
    .lost-found-container button:hover {
        background: #4f46e5;
    }
    .post {
        background: rgba(255,255,255,0.1);
        padding: 15px;
        margin-bottom: 20px;
        border-radius: 12px;
        text-align: left;
    }
    .post img {
        max-width: 100%;
        border-radius: 8px;
        margin-top: 10px;
    }
    .comment-box input {
        width: calc(100% - 90px);
        display: inline-block;
    }
    .comment-box button {
        width: 80px;
        display: inline-block;
    }
</style>

<div class="lost-found-container">
    <h1>Lost & Found</h1>
    <p>Report lost items or found items. Add comments on posts below.</p>

    <form method="POST" enctype="multipart/form-data">
        {% csrf_token %}
        <select name="status" required>
            <option value="">I want to...</option>
            <option value="lost">Report Lost Item</option>
            <option value="found">Report Found Item</option>
        </select>

        <input type="text" name="name" placeholder="Your Name" required>
        <input type="text" name="department" placeholder="Department" required>
        <input type="text" name="location" placeholder="Location" required>
        <textarea name="description" placeholder="Item Description" rows="4" required></textarea>
        <input type="file" name="image">
        <input type="submit" value="Submit">
    </form>

    <hr style="margin:30px 0; border-color: rgba(255,255,255,0.3); width:80%;">

    <h2>Recent Posts</h2>
    {% for post in posts %}
    <div class="post">
        <h3>{{ post.user.username }} - {{ post.user_type|capfirst }}</h3>
        <p><strong>Department:</strong> {{ post.department }}</p>
        <p><strong>Location:</strong> {{ post.location }}</p>
        <p><strong>Status:</strong> {{ post.category|capfirst }}</p>
        <p>{{ post.description }}</p>
        {% if post.image %}
            <img src="{{ post.image.url }}" alt="Item Image">
        {% endif %}

        <div class="comment-box" style="margin-top:10px;">
            <h4>Comments:</h4>
            {% for comment in post.comments.all %}
                <p><strong>{{ comment.user.username }}:</strong> {{ comment.comment }}</p>
            {% empty %}
                <p>No comments yet.</p>
            {% endfor %}

            <form method="POST" class="comment-form">
                {% csrf_token %}
                <input type="hidden" name="post_id" value="{{ post.id }}">
                <input type="text" name="comment" placeholder="Add a comment..." required>
                <button type="submit">Comment</button>
            </form>
        </div>
    </div>
    {% empty %}
        <p>No posts yet.</p>
    {% endfor %}
</div>

<script>
    document.body.classList.add('lost-found-bg');
</script>
{% endblock %}
